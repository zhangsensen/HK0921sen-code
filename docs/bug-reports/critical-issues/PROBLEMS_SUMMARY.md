# 系统性问题总结与优先级评估

## 1. 核心问题概览
| 编号 | 问题 | 代码位置 | 优先级 | 影响范围 |
| --- | --- | --- | --- | --- |
| P1 | Phase 1 回测过度保护导致核心指标被清零 | `phase1/backtest_engine.py:33-133` | 阻塞 | 所有单因子指标、Phase 2 输入 |
| P2 | 数据质量验证器对“极值”做硬性归零 | `utils/data_quality.py:12-220` | 阻塞 | 因子与组合结果持久化 |
| P3 | 组合策略缺失时间框架元数据 | `database.py:100-334`、`phase2/combiner.py:90-205` | 高 | 组合追踪、回归分析、审计 |

## 2. 问题关联性与依赖关系
- **P1 → P2 级联**：回测返回的 Sharpe/WinRate 在 `save_exploration_results` 前被 DataQualityValidator 再次清零，放大故障覆盖面。
- **P1/P2 → Phase 2**：`MultiFactorCombiner.select_top_factors` 依赖 Sharpe/IC 做排序，指标被清零后组合策略近似随机。
- **P3 → 报告/监控**：组合策略缺少时间框架，任何回放或审计无法判断 1m RSI 与 1h RSI 差异；也阻塞告警归因。
- **紧密耦合环**：数据库中零值指标 → 组合筛选失真 → CI 基准无效 → 运维告警失真。

## 3. 风险与影响矩阵
| 维度 | 技术风险 | 业务风险 | 信任风险 |
| --- | --- | --- | --- |
| 强度 | 高：指标失真导致 TopN 因子全量无效 | 高：交易策略选择基于错误信息 | 极高：监控与报告产生“虚假安全感” |
| 概率 | 已发生（100% 因子受影响） | 高（生产策略完全依赖该流水线） | 高（数据团队与业务侧都引用报告） |
| 可见度 | 低（原保护逻辑静默执行） | 中（收益回测异常但难定位） | 低（对外报告仍显示“正常”） |

## 4. 优先级与修复窗口
1. **立即（阻塞）**：解除回测保护器与数据验证器的强行清零，恢复指标可信度。
2. **短期（高）**：扩展组合持久化模型，补齐 `timeframes` 字段并生成迁移脚本。
3. **中期**：重新回放历史数据，重建 Phase 1/2 基线，验证监控报警逻辑。
4. **长期**：为保护器与验证器引入可配置参数、权重化诊断体系，以及异常指标的旁路审计报表。

## 5. 监控与验证建议
- 新增“诊断”字段：Phase 1 回测返回 `diagnostics` 提示低交易次数或极端 Sharpe，供监控与 DataQualityValidator 记录（不再篡改指标）。
- 在 DataQualityValidator 中保留原始值，仅通过 `_validation_violations` 记录警告；同步统计高风险行数。
- 组合策略持久化时保存 `<factor, timeframe>` 对，便于做 Drill-down 与回放。

以上问题已完成代码修复（参见各专题文档与修复指南），需立即回放数据验证。
